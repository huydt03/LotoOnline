const app=(()=>{function c(d,e=[]){function f(b){let a={fire:e,remove:f,clear:g,count:h},c="empty",d={};function e(){let a=[];for(let b in d)for(let c in d[b])a.push(d[b][c](arguments));return a}function f(a){"function"==typeof a&&delete d[a.name?a.name:c]}function g(){d={}}function h(){let a=0;for(let b in d)a+=d[b].length;return a}return Object.defineProperties(a,{_:{set:function(a){if("function"!=typeof a)return;let b=a.name?a.name:c;d[b]||(d[b]=[]),d[b].push(a)}},fire:{get:function(){return e}},remove:{get:function(){return f}},clear:{get:function(){return g}},count:{get:function(){return h}}}),a}function a(a,b){let e=new f(a);c[a]=null,Object.defineProperty(c,a,{get:function(){return e}}),d[a]=null,Object.defineProperty(d,a,{set:function(a){e._=a}}),"function"==typeof b&&(d[a]=b)}function b(){for(let b in arguments)a(arguments[b],null)}let c={listen:a,add:b};return function(){for(let f in d.handle=c,e)a(e[f]);Object.defineProperties(c,{listen:{get:function(){return a}},add:{get:function(){return b}}}),Object.defineProperty(d,"handle",{get:function(){return c}})}(),c}let d={NOTIFY:"ntf",APP:{INIT:"init",SERVERS:"sv",SERVER:"mm"},PLAYER:{UPDATE:"a",OTHER_UPDATE:"b"},ROOMS:{INFO:"ri",GET_PLAYERS:"c",GET_ROOMS:"d",ENTER:"re",LEAVE:"ll",CHAT:"cc"},ROOM:{INFO:"rj",GET_PLAYERS:"e",CREATE:"f",DESTROY:"dt",ENTER:"g",LEAVE:"h",UPDATE:"i",OTHER_UPDATE:"ro",KICKPLAYER:"k",CHAT:"cr"},GAME:{WAIT_START:"l",START:"m",STATUS:"n",GET_PAGES:"o",BUY_PAGE:"q",NUM_CALLED:"z",NUMS_CALLED:"r",CHECK_PAGE:"t",CHANGE_PAGE:"u",WAIT_CHECK_PAGE:"v",WINNER:"qq",END:"qe",UPDATE:"qr"},OTHER_CONNECT:"oc",ERROR:"error",DISCONNECT:"disconnect"},e={WAIT:1.5,START:2.5,STARTTING:3.5,PAUSE:4.5,RESUME:5.5,END:6.5,WAIT_START:1.6,WAIT_CHECK:1.7},f=(()=>{let a={},c={capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},initHandleKey:function(e){let a="on",b=e.split("_");for(let f in b){let d=b[f].split("_");for(let g in d)a+=c.capitalizeFirstLetter(d[g])}return a},findHandleByKey:function(c){let b=c.split("."),a=d;for(let e in b)a=a[b[e]];return f.initHandleKey(a)},setCookie:function(a,b){document.cookie=`${a}=${b}`},getCookie:function(a,b){let d=`; ${document.cookie}`.split(`; ${a}=`);return 2===d.length?d.pop().split(";").shift():(c.setCookie(a,b),b)}};function b(){for(let b in c)Object.defineProperty(a,b,{get:function(){return c[b]}})}return b(),a})(),g=(()=>{let a=f.findHandleByKey("ERROR"),g=["onBeforeInit","onAfterInit","onEmit",a],h="token",i,j,b={},k=!1,l={toPlayer:a=>({id:a[0],username:a[1],money:a[2],online:!!a[3]&&a[3],roomId:a[4],nPages:a[5],roomPanelId:a[6],isRoomMaster:a[7]}),toRoom:a=>({id:a[0],nbet:a[1],ntime:a[2],status:a[3],nPages:a[4],nPlayers:a[5],hasPass:a[6]}),login(b=n()){l.logout(),(i=io("http://20.212.6.187",{secure:!0,transports:["websocket"],auth:{token:b}})).on("connect_error",b=>{j[a].fire(LANGS.CONNECT.ERROR),l.logout(),i.disconnect()}),i.on(d.APP.INIT,function(a){let{player:b,token:c}=a;m(c),o(d),j.onAfterInit.fire(b)})},logout(){i&&i.disconnect&&i.disconnect();let a=f.initHandleKey(d.PLAYER.UPDATE);j[a]&&j[a].fire([])},getToken:n,emit:function(b,c){k?(j[a].fire(LANGS.FAST_ACTION),j.onEmit.fire(!1)):(k=!0,i.emit(b,c),j.onEmit.fire(!0),setTimeout(function(){k=!1},222))}};function m(a,b=h){document.cookie=`${b}=${a}`}function n(b=h){let a=`; ${document.cookie}`.split(`; ${b}=`);if(2===a.length)return a.pop().split(";").shift()}function o(d,g){for(let e in d){let a=d[e];if("object"==typeof a){o(a,e);continue}let c=f.initHandleKey(a);j[c]||j.listen(c,b[c]),i.on(a,j[c].fire)}}function e(){for(let a in(j=new c(b,g)).onBeforeInit.fire(),l)Object.defineProperty(b,a,{get:function(){return l[a]}})}return e(),b})(),a=function(){let a=f.findHandleByKey("ERROR"),p=["onWorldUpdate","onLoading","onPlayerUpdate","onServersUpdate","onServerInfoUpdate","onServerRoomsUpdate","onServerPlayersUpdate","onRoomInfoUpdate","onRoomPlayersUpdate","onRoomPagesUpdate","onRoomNumsCalledUpdate","onRoomNumCalledUpdate","onChatMessageUpdate","onNWaitUpdate","onGameStatusUpdate",a],q={IN_SERVER:()=>!!j.info.id||(r[a].fire(LANGS.RULES.NOT_IN_SERVER),!1),NOT_IN_SERVER:()=>!j.info.id||(r[a].fire(LANGS.RULES.IN_SERVER+` ${j.info.name}!`),!1),ROOM_EXISTS:b=>!!j.rooms[b]||(r[a].fire(LANGS.RULES.NOT_ROOM_EXISTS),!1),IN_ROOM:(b=!0)=>!!q.IN_SERVER()&&(!!k.info.id||(b&&r[a].fire(LANGS.RULES.NOT_IN_ROOM),!1)),NOT_IN_ROOM:()=>!!q.IN_SERVER()&&(!k.info.id||(r[a].fire(LANGS.RULES.IN_ROOM),!1)),IS_ROOM_MASTER:()=>!!q.IN_ROOM()&&(!!m.isRoomMaster||(r[a].fire(LANGS.RULES.NOT_IS_ROOM_MASTER),!1)),NOT_HAS_PAGE:b=>!k.players[b][5]||(r[a].fire(LANGS.RULES.HAS_PAGE),!1),IS_GAME_WAIT:()=>!!q.IN_ROOM()&&(k.info.status==e.WAIT_START||k.info.status==e.WAIT||(r[a].fire(LANGS.RULES.IS_GAME_STARTED),!1)),IS_GAME_STARTED:()=>!!q.IN_ROOM()&&(k.info.status!=e.WAIT_START&&k.info.status!=e.WAIT||(r[a].fire(LANGS.RULES.IS_GAME_WAIT),!1))},h={login(a){g.login(a),r.onLoading.fire(!0)},logout:g.logout,chat(e){e.preventDefault();let c=e.target[0],b=c.value;if(c.value="",c.blur(),!b||b.length>100){r[a].fire(LANGS.RULES.INPUT_FAIL);return}q.IN_SERVER()&&(q.IN_ROOM(!1)?g.emit(d.ROOM.CHAT,b):g.emit(d.ROOMS.CHAT,b))},getServers(){q.NOT_IN_SERVER()&&g.emit(d.APP.SERVERS)},selectServer(a){q.NOT_IN_SERVER()&&g.emit(d.APP.SERVER,a)},serverLeave(){q.IN_SERVER()&&g.emit(d.ROOMS.LEAVE)},getRoomsList(){q.NOT_IN_ROOM()&&g.emit(d.ROOMS.GET_ROOMS)},getRoomsPlayers(){q.NOT_IN_ROOM()&&g.emit(d.ROOMS.GET_PLAYERS)},roomCreate(a){q.NOT_IN_ROOM()&&g.emit(d.ROOM.CREATE,a)},roomEnter(a){if(q.NOT_IN_ROOM()&&q.ROOM_EXISTS(a)){let b=j.rooms[a][6]?prompt(`Nhập mật khẩu ph\xf2ng "${a}"`):"";(b||""==b)&&g.emit(d.ROOM.ENTER,{roomId:a,password:b})}},roomLeave(){q.IN_ROOM()&&g.emit(d.ROOM.LEAVE)},roomKickPlayer(a){q.IN_ROOM()&&q.IS_ROOM_MASTER()&&q.NOT_HAS_PAGE(a)&&(g.emit(d.ROOM.KICKPLAYER,a),r.onLoading.fire(!1))},getRoomPlayers(){q.IN_ROOM()&&g.emit(d.ROOM.GET_PLAYERS)},gameBuyPage(){q.IS_GAME_WAIT()&&g.emit(d.GAME.BUY_PAGE)},gameChangePage(a){q.IS_GAME_WAIT()&&(g.emit(d.GAME.CHANGE_PAGE,a),s=a)},gameCheckPage(a){q.IS_GAME_STARTED()&&(g.emit(d.GAME.CHECK_PAGE,a),s=a)},gameGetPages(a){q.IN_ROOM()&&(g.emit(d.GAME.GET_PAGES,a),t=a)}},r,i={},j={info:{},rooms:{},players:{}},k={info:{},players:{},_pages:[],pages:{},numscalled:[]},l={music_1:JSON.parse(f.getCookie("music_1",!0)),music_2:JSON.parse(f.getCookie("music_2",!0)),music_3:JSON.parse(f.getCookie("music_3",!0))},b=new Audio,m={},n={servers:i,server:j,room:k,player:m,methods:h,cookie:l,audio:b},s,t,u={DA_DOI:"da_doi",DA_MUA:"da_mua",MOI_MUA:"xin_moi_mua_giay",CHUAN_BI:"chuan_bi_bat_dau",BAT_DAU:"bat_dau",DA_BAT_DAU:"game_da_bat_dau",CHUC_MUNG:"chuc_mung",DA_CO_NGUOI_KINH:"da_co_nguoi_kinh",DA_KINH:"da_kinh",DA_KINH_XO:"da_kinh_xo",BAO_KINH:"dang_cho_bao_kinh_trung",KET_THUC:"ket_thuc",HOAN_TAT:"hoan_tat",DANG_TIEC:"that_dang_tiec"},o={GOOGLE:"google",SING:"sing"},v=o.GOOGLE;function w(a){y(`effects/${a}`,l.music_2)}function x(){y("intro",l.music_1)}function y(a,c=!0){if(!c)return;let d=`audio/${a}.mp3`;b.src=d,setTimeout(function(){b.play()},150)}function z(){i={},j={info:{},rooms:{},players:{}},k={info:{},players:{},pages:{},numscalled:[]},m={}}return b.onended=function(){b.src.includes("intro")&&x()},g.onEmit=function(a){a[0]?r.onLoading.fire(!0):r.onLoading.fire(!1)},g.onAfterInit=function(a){m=g.toPlayer(a[0]),r.onPlayerUpdate.fire(m),r.onLoading.fire(!1),x()},g[f.findHandleByKey("NOTIFY")]=function(a){r.onWorldUpdate.fire({notify:a[0]})},g[f.findHandleByKey("APP.SERVERS")]=function(c){let a=c[0];for(let b in i=[],a)i.push({id:a[b][0],name:a[b][1],nPlayers:a[b][2]});r.onServersUpdate.fire(i),r.onLoading.fire(!1)},g[f.findHandleByKey("APP.SERVER")]=function(a){},g[f.findHandleByKey("PLAYER.UPDATE")]=function(a){m=g.toPlayer(a[0]),r.onPlayerUpdate.fire(m)},g[f.findHandleByKey("PLAYER.OTHER_UPDATE")]=function(b){let a=b[0];j.players[a[0]]=a,a[6]||delete j.players[a[0]],r.onServerPlayersUpdate.fire(j.players),k.info.id&&(k.players[a[0]]||r.onChatMessageUpdate.fire([a[0],`${LANGS.ROOM.ENTER}`,1]),k.players[a[0]]=a,a[4]||(delete k.players[a[0]],r.onChatMessageUpdate.fire([a[0],`${LANGS.ROOM.LEAVE}`,1])),r.onRoomPlayersUpdate.fire(k.players))},g[f.findHandleByKey("ROOMS.INFO")]=function(a){j.info=a[0],r.onServerInfoUpdate.fire(j.info)},g[f.findHandleByKey("ROOMS.GET_PLAYERS")]=function(a){x(),j.players=a[0],r.onServerPlayersUpdate.fire(j.players),r.onLoading.fire(!1)},g[f.findHandleByKey("ROOMS.GET_ROOMS")]=function(a){j.rooms=a[0],r.onServerRoomsUpdate.fire(j.rooms),r.onLoading.fire(!1)},g[f.findHandleByKey("ROOMS.CHAT")]=function(a){r.onChatMessageUpdate.fire(a[0]),r.onLoading.fire(!1)},g[f.findHandleByKey("ROOM.UPDATE")]=g[f.findHandleByKey("ROOM.INFO")]=function(b){let a=g.toRoom(b[0]);if(a.status!=k.info.status)switch(a.status){case 1.5:r.onGameStatusUpdate.fire(LANGS.GAME.WAIT),r.onChatMessageUpdate.fire([`#${a.id}`,`${LANGS.GAME.WAIT}`,4]),w(u.MOI_MUA);break;case 1.6:r.onGameStatusUpdate.fire(LANGS.GAME.WAIT_START),r.onChatMessageUpdate.fire([`#${a.id}`,`${LANGS.GAME.WAIT_START}`,4]),w(u.CHUAN_BI);break;case 6.5:case 1.7:r.onGameStatusUpdate.fire(LANGS.GAME.WAIT_CHECK),r.onChatMessageUpdate.fire([`#${a.id}`,`${LANGS.GAME.WAIT_CHECK}`,4]),w(u.BAO_KINH);break;case 2.5:case 3.5:case 4.5:r.onGameStatusUpdate.fire(LANGS.GAME.STARTTING),r.onChatMessageUpdate.fire([`#${a.id}`,`${LANGS.GAME.STARTTING}`,4]),w(u.DA_BAT_DAU)}k.info=a,v=0==k.info.ntime?o.SING:o.GOOGLE,r.onRoomInfoUpdate.fire(k.info)},g[f.findHandleByKey("ROOM.GET_PLAYERS")]=function(a){k.players=a[0],r.onRoomPlayersUpdate.fire(k.players),r.onLoading.fire(!1)},g[f.findHandleByKey("ROOM.CHAT")]=function(a){r.onChatMessageUpdate.fire(a[0]),r.onLoading.fire(!1)},g[f.findHandleByKey("ROOM.OTHER_UPDATE")]=function(b){let a=b[0];j.rooms[a[0]]=a,a[5]||delete j.rooms[a[0]],r.onServerRoomsUpdate.fire(j.rooms)},g[f.findHandleByKey("ROOM.KICKPLAYER")]=function(a){},g[f.findHandleByKey("GAME.WAIT_START")]=function(a){r.onNWaitUpdate.fire(a[0])},g[f.findHandleByKey("GAME.START")]=function(a){},g[f.findHandleByKey("GAME.STATUS")]=function(a){},g[f.findHandleByKey("GAME.GET_PAGES")]=function(b){let a=b[0];for(let c in k.pages=a,k._pages=[],a)k._pages.push(parseInt(c));r.onRoomPagesUpdate.fire(k.pages,k._pages,k._pages.at(-1),t),t=null,r.onLoading.fire(!1)},g[f.findHandleByKey("GAME.BUY_PAGE")]=function(b){let a=b[0];k.pages[a.id]=a.nums,k._pages.push(a.id),r.onRoomPagesUpdate.fire(k.pages,k._pages,k._pages.at(-1)),r.onLoading.fire(!1),w(u.DA_MUA)},g[f.findHandleByKey("GAME.NUM_CALLED")]=function(b){let a=b[0];k.numscalled.push(a),r.onRoomNumCalledUpdate.fire(a),y(`nums/${v}/${a}`,l.music_3)},g[f.findHandleByKey("GAME.NUMS_CALLED")]=function(a){k.numscalled=a[0],r.onRoomNumsCalledUpdate.fire(k.numscalled)},g[f.findHandleByKey("GAME.CHECK_PAGE")]=function(b){delete k.pages[s];let a=k._pages.indexOf(parseInt(s));k._pages.splice(a,1),a=--a>0?a:0,r.onRoomPagesUpdate.fire(k.pages,k._pages,k._pages[a]),r.onLoading.fire(!1),b[0].result?w(u.DA_KINH):w(u.DA_KINH_XO)},g[f.findHandleByKey("GAME.CHANGE_PAGE")]=function(a){let b=a[0];k.pages[s]=b,r.onRoomPagesUpdate.fire(k.pages,k._pages,s),r.onLoading.fire(!1),w(u.DA_DOI)},g[f.findHandleByKey("GAME.WAIT_CHECK_PAGE")]=function(a){r.onNWaitUpdate.fire(a[0],1)},g[f.findHandleByKey("GAME.WINNER")]=function(a){let b=a[0];r.onChatMessageUpdate.fire([b,`${LANGS.PLAYER.WINNER}`,2]),w(u.DA_CO_NGUOI_KINH)},g[f.findHandleByKey("GAME.END")]=function(a){k._pages=[],k.pages={},k.numscalled=[],r.onRoomPagesUpdate.fire(k.pages,k._pages),r.onRoomNumsCalledUpdate.fire(k.numscalled),w(u.KET_THUC)},g[f.findHandleByKey("GAME.UPDATE")]=function(a){},g[f.findHandleByKey("OTHER_CONNECT")]=function(b){z(),r[a].fire(LANGS.CONNECT.OTHER),r.onPlayerUpdate.fire(),r.onLoading.fire(!1)},g[a]=function(b){r[a].fire(b[0]),r.onLoading.fire(!1)},g[f.findHandleByKey("DISCONNECT")]=function(a){z(),r.onLoading.fire(!1)},!function(){for(let a in r=new c(n,p),h)Object.defineProperty(n,a,{get:function(){return h[a]}});Object.defineProperties(n,{servers:{get:function(){return i}},server:{get:function(){return j}},room:{get:function(){return k}},player:{get:function(){return m}},methods:{get:function(){return h}}})}(),n}();!function(){history.pushState(null,null,location.href);let a=!1;window.onpopstate=function(){history.go(1),a||(b.goBack(),a=!0,setTimeout(function(){a=!1},150))}}();let b=new Vue({el:"#app",data:{LANGS,scene:1,fee:.95,limit_players:100,show_loading:!1,show_modal:!1,modal_content:"",game_status:"",world_notify:LANGS.APP.WELCOME,chat_contents:[[null,LANGS.APP.WELCOME,3]],n_wait:[],right_bar_active:!1,cookie:a.cookie,show_modal_create:!1,show_modal_options:!1,nbet:0,ntime:2,music_on:9999,page_selected:null,auto_check:!0,player:{},servers:{},server:{info:{},players:{},rooms:[]},room:{info:{},players:{},_pages:[],pages:{},numscalled:[],o_numscalled:[],action_pages:null}},methods:{_set_music(d){let c=`music_${d}`;if(b.cookie[c]=!b.cookie[c],f.setCookie(c,b.cookie[c]),b.cookie[c])switch(c){case"music_1":a.audio.src.includes("intro")&&a.audio.play();break;case"music_2":a.audio.src.includes("effects/")&&a.audio.play();break;case"music_3":a.audio.src.includes("nums/")&&a.audio.play()}else switch(c){case"music_1":a.audio.src.includes("intro")&&a.audio.pause();break;case"music_2":a.audio.src.includes("effects/")&&a.audio.pause();break;case"music_3":a.audio.src.includes("nums/")&&a.audio.pause()}},_page_selected(a){b.page_selected=a},money_format:a=>`${a=Math.round(a)}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")+"\u0111",status_to_string(a){switch(a){case 1.5:return LANGS.GAME.WAIT;case 1.6:return LANGS.GAME.WAIT_START;case 6.5:case 1.7:return LANGS.GAME.WAIT_CHECK;case 2.5:case 3.5:case 4.5:return LANGS.GAME.STARTTING}},goBack(a){switch(b.scene){case SCENES.ROOM:b.roomLeave();break;case SCENES.SERVER:b.serverLeave();break;case SCENES.SERVERS:b.logout()}},_roomEnter(c){c.preventDefault();let a=c.target[0],d=a.value;return a.value="",a.blur(),b.roomEnter(d),!1},_show_modal_create(a){b.show_modal_create=!b.show_modal_create},_show_modal_options(a){b.show_modal_options=!b.show_modal_options},_roomCreate(a){a.preventDefault();let c=a.target[0].value,d=a.target[2].checked?b.music_on:1e3*a.target[1].value,e=a.target[3].value;b.show_modal_create=!1,b.roomCreate({nbet:c,ntime:d,password:e})},_right_bar_active(a){b.right_bar_active=!b.right_bar_active},_gameGetPages(a){b.gameGetPages(a),b.right_bar_active=!1},...a.methods}});return a.onWorldUpdate=function(c){let a=c[0];b.world_notify=a.notify?a.notify:b.world_notify},a.onLoading=function(a){b.show_loading=a[0]},a.onError=function(a){b.show_modal=!0,b.modal_content=a[0]},a.onPlayerUpdate=function(c){b.player=a.player,b.player.roomId?b.scene=SCENES.ROOM:b.player.roomPanelId?b.scene=SCENES.SERVER:b.player.id?b.scene=SCENES.SERVERS:b.scene=SCENES.LOGIN},a.onServersUpdate=function(a){b.servers=a[0]},a.onServerInfoUpdate=function(a){b.server.info=a[0]},a.onServerRoomsUpdate=function(a){b.server.rooms=Object.values(a[0]).sort(function(a,b){return a[3]-b[3]})},a.onServerPlayersUpdate=function(a){b.server.players={},b.server.players=Object.values(a[0]).sort(function(a,b){return a[8]-b[8]}),b.n_wait=[]},a.onRoomInfoUpdate=function(a){b.room.info=a[0]},a.onRoomPlayersUpdate=function(a){b.room.players=a[0]},a.onRoomPagesUpdate=function(a){b.room.pages=a[0],b.room._pages=a[1],b.page_selected=a[2]?a[2]:b.page_selected;let c=a[3],d=b.room.players[c];d&&c!=b.player.id?b.room.action_pages=d:b.room.action_pages=null},a.onRoomNumsCalledUpdate=function(a){for(let c in b.room.numscalled=a[0],b.room.o_numscalled={},a[0])b.room.o_numscalled[a[0][c]]=!0},a.onRoomNumCalledUpdate=function(a){let c=a[0];b.room.o_numscalled[c]=b.auto_check},a.onChatMessageUpdate=function(e){let c=e[0],d=a.server.players[c[0]];d||(d=a.room.players[c[0]]),d?b.chat_contents.push([d[1],c[1],c[2]]):b.chat_contents.push(c)},a.onGameStatusUpdate=function(a){b.game_status=a[0]},a.onNWaitUpdate=function(a){b.n_wait=a},b})()
